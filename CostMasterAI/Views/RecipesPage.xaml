<Page
    x:Class="CostMasterAI.Views.RecipesPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:helpers="using:CostMasterAI.Helpers"
    mc:Ignorable="d">

    <Page.Resources>
        <helpers:BindingProxy x:Key="ViewModelProxy" Data="{Binding}" />
        <SolidColorBrush x:Key="CardBackground" Color="#0AFFFFFF" />
        <SolidColorBrush x:Key="CardBorder" Color="#1FFFFFFF" />
    </Page.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="320"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Grid Grid.Column="0" Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}" BorderThickness="0,0,1,0" BorderBrush="{StaticResource CardBorder}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <StackPanel Spacing="12" Padding="16,24,16,12">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <SymbolIcon Symbol="Library" Foreground="CornflowerBlue"/>
                    <TextBlock Text="Database Resep" FontWeight="Bold" FontSize="16"/>
                </StackPanel>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox PlaceholderText="Cari / Tambah Baru..." Text="{Binding NewRecipeName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" CornerRadius="4"/>
                    <Button Grid.Column="1" Command="{Binding CreateRecipeCommand}" Style="{StaticResource AccentButtonStyle}" Margin="8,0,0,0" ToolTipService.ToolTip="Buat Resep Baru">
                        <SymbolIcon Symbol="Add"/>
                    </Button>
                </Grid>
            </StackPanel>

            <ListView Grid.Row="1" ItemsSource="{Binding Recipes}" SelectedItem="{Binding SelectedRecipe, Mode=TwoWay}" Padding="12,0">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Grid Padding="12,8" CornerRadius="4" Margin="0,4">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel>
                                <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="14"/>
                                <StackPanel Orientation="Horizontal" Spacing="6" Opacity="0.6">
                                    <FontIcon Glyph="&#xE81C;" FontSize="10"/>
                                    <TextBlock Text="{Binding Version}" FontSize="11"/>
                                    <TextBlock Text="â€¢"/>
                                    <TextBlock Text="Sub-R" FontSize="10" Foreground="Orange" Visibility="{Binding IsSubRecipe, Converter={StaticResource BoolVisConv}}"/>
                                </StackPanel>
                            </StackPanel>

                            <TextBlock Grid.Column="1" Text="{Binding TotalBatchCost, Converter={StaticResource MoneyConv}}" 
                                       VerticalAlignment="Center" FontWeight="Bold" FontSize="12" Foreground="{ThemeResource SystemControlForegroundAccentBrush}"/>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <Grid Grid.Row="2" Padding="16" Background="#05000000">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="4" Opacity="0.5">
                    <TextBlock Text="Total:" FontSize="11"/>
                    <TextBlock Text="{Binding Recipes.Count}" FontSize="11"/>
                    <TextBlock Text="Resep" FontSize="11"/>
                </StackPanel>
            </Grid>
        </Grid>

        <Grid Grid.Column="1" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Grid Grid.Row="0" Padding="24,20" BorderThickness="0,0,0,1" BorderBrush="{StaticResource CardBorder}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Spacing="4">
                    <TextBox Text="{Binding SelectedRecipe.Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                             FontSize="24" FontWeight="Bold" BorderThickness="0" Background="Transparent" Padding="0"/>
                    <TextBox Text="{Binding SelectedRecipe.Description, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                             PlaceholderText="Tambahkan deskripsi resep di sini..." 
                             FontStyle="Italic" Opacity="0.6" BorderThickness="0" Background="Transparent" Padding="0"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12" VerticalAlignment="Top">
                    <StackPanel Orientation="Horizontal" Spacing="4" Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}" CornerRadius="4" Padding="4">
                        <Button Background="Transparent" BorderThickness="0" Command="{Binding GenerateDescriptionCommand}" ToolTipService.ToolTip="AI Write Description">
                            <SymbolIcon Symbol="Edit"/>
                        </Button>
                        <Button Background="Transparent" BorderThickness="0" Command="{Binding AutoGenerateIngredientsCommand}" ToolTipService.ToolTip="AI Auto-Ingredients">
                            <SymbolIcon Symbol="Highlight"/>
                        </Button>
                        <ProgressRing IsActive="{Binding IsAiLoading}" Width="16" Height="16" Margin="4,0"/>
                    </StackPanel>

                    <Grid Background="{ThemeResource SystemControlBackgroundBaseLowBrush}" CornerRadius="4" Padding="8,4" BorderThickness="1" BorderBrush="{ThemeResource SystemControlForegroundAccentBrush}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <SymbolIcon Symbol="Calculator" Margin="0,0,8,0" Foreground="{ThemeResource SystemControlForegroundAccentBrush}"/>
                        <TextBox Grid.Column="1" PlaceholderText="Target Qty" Text="{Binding TargetScalingQty, Mode=TwoWay}" Width="80" VerticalAlignment="Center"/>
                        <Button Grid.Column="2" Content="Scale" Command="{Binding ScaleRecipeCommand}" Margin="8,0,0,0" Style="{StaticResource AccentButtonStyle}" Height="32"/>
                    </Grid>
                </StackPanel>
            </Grid>

            <ScrollViewer Grid.Row="1" Padding="24">
                <StackPanel Spacing="24">

                    <Grid Background="{StaticResource CardBackground}" BorderBrush="{StaticResource CardBorder}" BorderThickness="1" CornerRadius="8" Padding="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Grid Margin="0,0,0,12">
                            <TextBlock Text="ðŸ“‹ Meta Data &amp; Properties" FontWeight="Bold" Opacity="0.5" VerticalAlignment="Center"/>

                            <ToggleSwitch HorizontalAlignment="Right" OnContent="Sub-Recipe Aktif" OffContent="Sub-Recipe Nonaktif" 
                                          IsOn="{Binding SelectedRecipe.IsSubRecipe, Mode=TwoWay}"
                                          ToolTipService.ToolTip="Jika aktif, resep ini akan muncul di daftar bahan baku resep lain."/>
                        </Grid>

                        <Grid Grid.Row="1" ColumnSpacing="16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBox Grid.Column="0" Header="Versi Resep" Text="{Binding SelectedRecipe.Version, Mode=TwoWay}" PlaceholderText="1.0"/>
                            <TextBox Grid.Column="1" Header="Umur Simpan" Text="{Binding SelectedRecipe.ShelfLife, Mode=TwoWay}" PlaceholderText="1 Hari"/>
                            <TextBox Grid.Column="2" Header="Prep Time (Min)" Text="{Binding SelectedRecipe.PrepMinutes, Mode=TwoWay}"/>

                            <Button Grid.Column="3" Content="Update &amp; Sync" Command="{Binding UpdateRecipeDetailsCommand}" VerticalAlignment="Bottom"/>
                        </Grid>
                    </Grid>

                    <TabView IsAddTabButtonVisible="False">

                        <TabViewItem Header="Ingredients Engine">
                            <TabViewItem.IconSource>
                                <SymbolIconSource Symbol="List"/>
                            </TabViewItem.IconSource>

                            <StackPanel Spacing="16" Padding="0,16,0,0">
                                <Grid Background="#1500FF00" BorderBrush="Green" BorderThickness="1" CornerRadius="8" Padding="12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBox Grid.Column="0" Header="Cooking Loss %" Text="{Binding SelectedRecipe.CookingLossPercent, Mode=TwoWay}" Width="100" Margin="0,0,16,0"/>
                                    <TextBox Grid.Column="1" Header="Target Berat (g)" Text="{Binding SelectedRecipe.TargetPortionSize, Mode=TwoWay}" Width="120" Margin="0,0,16,0"/>
                                    <Button Grid.Column="2" Content="Hitung Real Yield" Command="{Binding RecalculateYieldFromMassCommand}" VerticalAlignment="Bottom"/>

                                    <StackPanel Grid.Column="4" VerticalAlignment="Center" HorizontalAlignment="Right">
                                        <TextBlock Text="Total Output:" FontSize="10" Opacity="0.6" HorizontalAlignment="Right"/>
                                        <StackPanel Orientation="Horizontal" Spacing="4">
                                            <TextBlock Text="{Binding SelectedRecipe.YieldQty}" FontSize="24" FontWeight="Bold" Foreground="Green"/>
                                            <TextBlock Text="Porsi" VerticalAlignment="Bottom" Margin="0,0,0,4"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Grid>

                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <Grid Grid.Row="0" Margin="0,0,0,12" ColumnSpacing="8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="2*"/>
                                            <ColumnDefinition Width="1*"/>
                                            <ColumnDefinition Width="1*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <ComboBox Grid.Column="0" PlaceholderText="Pilih Bahan / Sub-Recipe..." ItemsSource="{Binding AvailableIngredients}" SelectedItem="{Binding SelectedIngredientToAdd, Mode=TwoWay}" DisplayMemberPath="Name" HorizontalAlignment="Stretch"/>
                                        <TextBox Grid.Column="1" PlaceholderText="Qty" Text="{Binding UsageQtyInput, Mode=TwoWay}"/>
                                        <ComboBox Grid.Column="2" PlaceholderText="Unit" ItemsSource="{Binding UnitOptions}" SelectedItem="{Binding SelectedUsageUnit, Mode=TwoWay}" HorizontalAlignment="Stretch"/>
                                        <Button Grid.Column="3" Content="Add" Command="{Binding AddItemToRecipeCommand}" Style="{StaticResource AccentButtonStyle}"/>
                                    </Grid>

                                    <ListView Grid.Row="1" ItemsSource="{Binding SelectedRecipe.Items}" SelectionMode="None">
                                        <ListView.Header>
                                            <Grid Padding="12,8" Background="{StaticResource CardBackground}" BorderThickness="0,0,0,1" BorderBrush="{StaticResource CardBorder}">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="100"/>
                                                    <ColumnDefinition Width="100"/>
                                                    <ColumnDefinition Width="150"/>
                                                    <ColumnDefinition Width="50"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="NAMA BAHAN" FontSize="11" Opacity="0.5" FontWeight="Bold"/>
                                                <TextBlock Text="QTY" Grid.Column="1" FontSize="11" Opacity="0.5" FontWeight="Bold"/>
                                                <TextBlock Text="TIPE" Grid.Column="2" FontSize="11" Opacity="0.5" FontWeight="Bold"/>
                                                <TextBlock Text="SUBTOTAL" Grid.Column="3" FontSize="11" Opacity="0.5" FontWeight="Bold" HorizontalAlignment="Right"/>
                                            </Grid>
                                        </ListView.Header>
                                        <ListView.ItemTemplate>
                                            <DataTemplate>
                                                <Grid Padding="12,8" BorderThickness="0,0,0,1" BorderBrush="#11000000">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="100"/>
                                                        <ColumnDefinition Width="100"/>
                                                        <ColumnDefinition Width="150"/>
                                                        <ColumnDefinition Width="50"/>
                                                    </Grid.ColumnDefinitions>

                                                    <StackPanel VerticalAlignment="Center">
                                                        <TextBlock Text="{Binding Ingredient.Name}" FontWeight="SemiBold"/>
                                                        <TextBlock Text="Setengah Jadi" FontSize="10" Foreground="Blue" 
                                                                   Visibility="{Binding Ingredient.LinkedRecipeId, Converter={StaticResource BoolVisConv}}"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                                        <TextBlock Text="{Binding UsageQty}"/>
                                                        <TextBlock Text="{Binding UsageUnit}" Margin="4,0,0,0" Opacity="0.6"/>
                                                    </StackPanel>

                                                    <CheckBox Grid.Column="2" Content="Per Unit" IsChecked="{Binding IsUnitBased, Mode=TwoWay}" 
                                                              Command="{Binding Data.ToggleItemUnitBasedCommand, Source={StaticResource ViewModelProxy}}" CommandParameter="{Binding}" MinWidth="0"/>

                                                    <TextBlock Grid.Column="3" Text="{Binding CalculatedCost, Converter={StaticResource MoneyConv}}" HorizontalAlignment="Right" VerticalAlignment="Center" Foreground="Green"/>

                                                    <Button Grid.Column="4" Content="âœ•" Command="{Binding Data.RemoveItemFromRecipeCommand, Source={StaticResource ViewModelProxy}}" CommandParameter="{Binding}" 
                                                            Background="Transparent" BorderThickness="0" Foreground="Red"/>
                                                </Grid>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                    </ListView>
                                </Grid>
                            </StackPanel>
                        </TabViewItem>

                        <TabViewItem Header="Operation &amp; Labor">
                            <TabViewItem.IconSource>
                                <SymbolIconSource Symbol="Setting"/>
                            </TabViewItem.IconSource>
                            <StackPanel Spacing="24" Padding="0,16,0,0">
                                <Grid Background="#10FF0000" BorderBrush="OrangeRed" BorderThickness="1" CornerRadius="8" Padding="16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel>
                                        <TextBlock Text="ðŸ‘· Tenaga Kerja Langsung (Direct Labor)" FontWeight="Bold" Foreground="OrangeRed" Margin="0,0,0,12"/>
                                        <StackPanel Orientation="Horizontal" Spacing="16">
                                            <TextBox Header="Durasi Masak (Menit)" Text="{Binding SelectedRecipe.LaborMinutes, Mode=TwoWay}" Width="150"/>
                                            <TextBox Header="Gaji per Jam (Rp)" Text="{Binding SelectedRecipe.LaborHourlyRate, Mode=TwoWay}" Width="150"/>
                                            <Button Content="Update Biaya" Command="{Binding UpdateRecipeDetailsCommand}" VerticalAlignment="Bottom"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Right">
                                        <TextBlock Text="Biaya Labor:" FontSize="10" Opacity="0.6" HorizontalAlignment="Right"/>
                                        <TextBlock Text="{Binding SelectedRecipe.TotalLaborCost, Converter={StaticResource MoneyConv}}" FontSize="20" FontWeight="Bold" Foreground="OrangeRed"/>
                                    </StackPanel>
                                </Grid>

                                <StackPanel>
                                    <TextBlock Text="Factory Overhead (Listrik, Gas, Kemasan)" FontWeight="Bold" Margin="0,0,0,8"/>
                                    <Grid Margin="0,0,0,8" ColumnSpacing="8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="150"/>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBox Grid.Column="0" PlaceholderText="Nama Biaya (Contoh: Gas)" Text="{Binding NewOverheadName, Mode=TwoWay}"/>
                                        <TextBox Grid.Column="1" PlaceholderText="Total Biaya" Text="{Binding NewOverheadCost, Mode=TwoWay}"/>
                                        <TextBox Grid.Column="2" PlaceholderText="Batch" Text="{Binding UsageCycles, Mode=TwoWay}" ToolTipService.ToolTip="Dibagi berapa kali produksi?"/>
                                        <Button Grid.Column="3" Content="Add" Command="{Binding AddOverheadCommand}"/>
                                    </Grid>

                                    <ListView ItemsSource="{Binding SelectedRecipe.Overheads}" Background="{StaticResource CardBackground}" CornerRadius="4">
                                        <ListView.ItemTemplate>
                                            <DataTemplate>
                                                <Grid Padding="12,8" BorderThickness="0,0,0,1" BorderBrush="#11000000">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="150"/>
                                                        <ColumnDefinition Width="50"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="1" Text="{Binding Cost, Converter={StaticResource MoneyConv}}" HorizontalAlignment="Right" Foreground="OrangeRed" VerticalAlignment="Center"/>
                                                    <Button Grid.Column="2" Content="âœ•" Command="{Binding Data.RemoveOverheadCommand, Source={StaticResource ViewModelProxy}}" CommandParameter="{Binding}" Background="Transparent" BorderThickness="0" Foreground="Red"/>
                                                </Grid>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                    </ListView>
                                </StackPanel>
                            </StackPanel>
                        </TabViewItem>

                        <TabViewItem Header="Pricing Strategy">
                            <TabViewItem.IconSource>
                                <SymbolIconSource Symbol="Shop"/>
                            </TabViewItem.IconSource>
                            <Grid Padding="0,16,0,0" ColumnSpacing="24">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="1.5*"/>
                                    <ColumnDefinition Width="1*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Spacing="24">
                                    <StackPanel Background="{StaticResource CardBackground}" Padding="16" CornerRadius="8" BorderThickness="1" BorderBrush="{StaticResource CardBorder}">

                                        <Grid Margin="0,0,0,8">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="ðŸŽ¯ Margin Target" FontWeight="Bold"/>
                                            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="2">
                                                <TextBlock Text="{Binding SelectedRecipe.TargetMarginPercent}" FontWeight="Bold" Foreground="Green"/>
                                                <TextBlock Text="%" FontWeight="Bold" Foreground="Green"/>
                                            </StackPanel>
                                        </Grid>

                                        <Slider Value="{Binding SelectedRecipe.TargetMarginPercent, Mode=TwoWay}" Minimum="0" Maximum="90" StepFrequency="5"/>
                                    </StackPanel>

                                    <StackPanel Background="{StaticResource CardBackground}" Padding="16" CornerRadius="8" BorderThickness="1" BorderBrush="{StaticResource CardBorder}">
                                        <TextBlock Text="ðŸ·ï¸ Harga Manual (Override)" FontWeight="Bold" Margin="0,0,0,8"/>
                                        <TextBox PlaceholderText="Rp 0 (Otomatis jika kosong)" Text="{Binding SelectedRecipe.ActualSellingPrice, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                        <TextBlock Text="Isi jika Anda ingin menetapkan harga tetap, mengabaikan margin target." FontSize="10" Opacity="0.5" Margin="0,4,0,0"/>
                                    </StackPanel>

                                    <StackPanel Background="{StaticResource CardBackground}" Padding="16" CornerRadius="8" BorderThickness="1" BorderBrush="{StaticResource CardBorder}">

                                        <Grid Margin="0,0,0,8">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="ðŸ›µ Online App Markup" FontWeight="Bold"/>
                                            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="2">
                                                <TextBlock Text="{Binding SelectedRecipe.OnlineMarkupPercent}" FontWeight="Bold" Foreground="Orange"/>
                                                <TextBlock Text="%" FontWeight="Bold" Foreground="Orange"/>
                                            </StackPanel>
                                        </Grid>

                                        <Slider Value="{Binding SelectedRecipe.OnlineMarkupPercent, Mode=TwoWay}" Minimum="0" Maximum="50"/>
                                    </StackPanel>

                                    <Button Content="Recalculate All Prices" Command="{Binding UpdateRecipeDetailsCommand}" HorizontalAlignment="Stretch" Style="{StaticResource AccentButtonStyle}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Spacing="12">
                                    <Grid Background="#10008000" BorderBrush="Green" BorderThickness="1" CornerRadius="8" Padding="16">
                                        <StackPanel>
                                            <TextBlock Text="ðŸ½ï¸ Dine-In Price" FontWeight="Bold" Foreground="Green"/>
                                            <TextBlock Text="{Binding SelectedRecipe.DineInPrice, Converter={StaticResource MoneyConv}}" FontSize="28" FontWeight="Bold" Margin="0,4"/>
                                            <TextBlock Text="Harga Menu Normal" FontSize="11" Opacity="0.6"/>
                                        </StackPanel>
                                    </Grid>

                                    <Grid Background="#10FFA500" BorderBrush="Orange" BorderThickness="1" CornerRadius="8" Padding="16">
                                        <StackPanel>
                                            <TextBlock Text="ðŸ›µ Online App Price" FontWeight="Bold" Foreground="Orange"/>
                                            <TextBlock Text="{Binding SelectedRecipe.OnlineAppPrice, Converter={StaticResource MoneyConv}}" FontSize="28" FontWeight="Bold" Margin="0,4"/>
                                            <TextBlock Text="Termasuk Markup Aplikasi" FontSize="11" Opacity="0.6"/>
                                        </StackPanel>
                                    </Grid>

                                    <Grid Background="#100000FF" BorderBrush="CornflowerBlue" BorderThickness="1" CornerRadius="8" Padding="16">
                                        <StackPanel>
                                            <TextBlock Text="ðŸ“¦ Wholesale Price" FontWeight="Bold" Foreground="CornflowerBlue"/>
                                            <TextBlock Text="{Binding SelectedRecipe.WholesalePrice, Converter={StaticResource MoneyConv}}" FontSize="28" FontWeight="Bold" Margin="0,4"/>
                                            <TextBlock Text="Harga Reseller / Grosir" FontSize="11" Opacity="0.6"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Grid>
                        </TabViewItem>

                        <TabViewItem Header="Cost Engineering (AI)">
                            <TabViewItem.IconSource>
                                <SymbolIconSource Symbol="Contact"/>
                            </TabViewItem.IconSource>

                            <ScrollViewer Padding="0,16,0,0">
                                <StackPanel Spacing="24">
                                    <TextBlock Text="ðŸ¤– AI Business Consultant" Style="{StaticResource SubtitleTextBlockStyle}" Opacity="0.5"/>

                                    <Grid Background="{StaticResource CardBackground}" BorderBrush="{StaticResource CardBorder}" BorderThickness="1" CornerRadius="8" Padding="16">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <Grid Margin="0,0,0,12">
                                            <StackPanel>
                                                <TextBlock Text="ðŸ” Recipe Auditor" FontWeight="Bold" Foreground="CornflowerBlue"/>
                                                <TextBlock Text="Analisa kewajaran Food Cost dibanding standar industri." FontSize="10" Opacity="0.6"/>
                                            </StackPanel>
                                            <Button HorizontalAlignment="Right" Command="{Binding AuditRecipeCostCommand}" IsEnabled="{Binding IsAuditing, Converter={StaticResource BoolNegationConv}}">
                                                <StackPanel Orientation="Horizontal" Spacing="8">
                                                    <ProgressRing IsActive="{Binding IsAuditing}" Width="16" Height="16" Visibility="{Binding IsAuditing, Converter={StaticResource BoolVisConv}}"/>
                                                    <TextBlock Text="Audit Sekarang"/>
                                                </StackPanel>
                                            </Button>
                                        </Grid>

                                        <TextBox Grid.Row="1" Text="{Binding AiAuditReport, Mode=OneWay}" IsReadOnly="True" AcceptsReturn="True" TextWrapping="Wrap" MinHeight="80" Background="#05000000"/>
                                    </Grid>

                                    <Grid Background="{StaticResource CardBackground}" BorderBrush="{StaticResource CardBorder}" BorderThickness="1" CornerRadius="8" Padding="16">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <Grid Margin="0,0,0,12">
                                            <StackPanel>
                                                <TextBlock Text="ðŸ“‰ Smart Substitution" FontWeight="Bold" Foreground="Green"/>
                                                <TextBlock Text="Saran penggantian bahan mahal untuk hemat HPP." FontSize="10" Opacity="0.6"/>
                                            </StackPanel>
                                            <Button HorizontalAlignment="Right" Command="{Binding GetSubstitutionIdeasCommand}" IsEnabled="{Binding IsSubstituting, Converter={StaticResource BoolNegationConv}}">
                                                <StackPanel Orientation="Horizontal" Spacing="8">
                                                    <ProgressRing IsActive="{Binding IsSubstituting}" Width="16" Height="16" Visibility="{Binding IsSubstituting, Converter={StaticResource BoolVisConv}}"/>
                                                    <TextBlock Text="Cari Alternatif"/>
                                                </StackPanel>
                                            </Button>
                                        </Grid>

                                        <TextBox Grid.Row="1" Text="{Binding AiSubstitutionReport, Mode=OneWay}" IsReadOnly="True" AcceptsReturn="True" TextWrapping="Wrap" MinHeight="80" Background="#05000000"/>
                                    </Grid>

                                    <Grid Background="{StaticResource CardBackground}" BorderBrush="{StaticResource CardBorder}" BorderThickness="1" CornerRadius="8" Padding="16">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <Grid Margin="0,0,0,12">
                                            <StackPanel>
                                                <TextBlock Text="â™»ï¸ Waste To Profit" FontWeight="Bold" Foreground="Orange"/>
                                                <TextBlock Text="Ide menu baru dari sisa bahan (Zero Waste)." FontSize="10" Opacity="0.6"/>
                                            </StackPanel>
                                            <Button HorizontalAlignment="Right" Command="{Binding GetWasteIdeasCommand}" IsEnabled="{Binding IsWasteAnalyzing, Converter={StaticResource BoolNegationConv}}">
                                                <StackPanel Orientation="Horizontal" Spacing="8">
                                                    <ProgressRing IsActive="{Binding IsWasteAnalyzing}" Width="16" Height="16" Visibility="{Binding IsWasteAnalyzing, Converter={StaticResource BoolVisConv}}"/>
                                                    <TextBlock Text="Analisa Limbah"/>
                                                </StackPanel>
                                            </Button>
                                        </Grid>

                                        <TextBox Grid.Row="1" Text="{Binding AiWasteReport, Mode=OneWay}" IsReadOnly="True" AcceptsReturn="True" TextWrapping="Wrap" MinHeight="80" Background="#05000000"/>
                                    </Grid>

                                </StackPanel>
                            </ScrollViewer>
                        </TabViewItem>

                        <TabViewItem Header="Creative Studio">
                            <TabViewItem.IconSource>
                                <SymbolIconSource Symbol="Video"/>
                            </TabViewItem.IconSource>

                            <ScrollViewer Padding="0,16,0,0">
                                <StackPanel Spacing="24">
                                    <TextBlock Text="ðŸŽ¨ Marketing &amp; Content Generator" Style="{StaticResource SubtitleTextBlockStyle}" Opacity="0.5"/>

                                    <Grid Background="{StaticResource CardBackground}" BorderBrush="{StaticResource CardBorder}" BorderThickness="1" CornerRadius="8" Padding="16">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <Grid Margin="0,0,0,12">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Spacing="8">
                                                <TextBlock Text="ðŸ“± Social Media Manager" FontWeight="Bold" Foreground="#E1306C"/>
                                                <StackPanel Orientation="Horizontal" Spacing="8">
                                                    <ComboBox ItemsSource="{Binding SocialPlatforms}" SelectedItem="{Binding SelectedSocialPlatform, Mode=TwoWay}" Width="140" PlaceholderText="Platform"/>
                                                    <ComboBox ItemsSource="{Binding SocialTones}" SelectedItem="{Binding SelectedSocialTone, Mode=TwoWay}" Width="140" PlaceholderText="Gaya Bahasa"/>
                                                </StackPanel>
                                            </StackPanel>

                                            <Button Grid.Column="1" VerticalAlignment="Bottom" Command="{Binding GenerateSocialMediaCommand}" IsEnabled="{Binding IsGeneratingSocial, Converter={StaticResource BoolNegationConv}}">
                                                <StackPanel Orientation="Horizontal" Spacing="8">
                                                    <ProgressRing IsActive="{Binding IsGeneratingSocial}" Width="16" Height="16" Visibility="{Binding IsGeneratingSocial, Converter={StaticResource BoolVisConv}}"/>
                                                    <TextBlock Text="Buat Caption"/>
                                                </StackPanel>
                                            </Button>
                                        </Grid>

                                        <TextBox Grid.Row="1" Text="{Binding AiSocialCaption, Mode=OneWay}" IsReadOnly="False" AcceptsReturn="True" TextWrapping="Wrap" MinHeight="100" Background="#05000000" PlaceholderText="Hasil caption akan muncul di sini..."/>
                                    </Grid>

                                    <Grid Background="{StaticResource CardBackground}" BorderBrush="{StaticResource CardBorder}" BorderThickness="1" CornerRadius="8" Padding="16">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <Grid Margin="0,0,0,12">
                                            <StackPanel>
                                                <TextBlock Text="ðŸ½ï¸ Hypnotic Menu Description" FontWeight="Bold" Foreground="Gold"/>
                                                <TextBlock Text="Deskripsi menu teknik NLP yang menggugah selera." FontSize="10" Opacity="0.6"/>
                                            </StackPanel>
                                            <Button HorizontalAlignment="Right" Command="{Binding GenerateHypnoticDescCommand}" IsEnabled="{Binding IsGeneratingHypnotic, Converter={StaticResource BoolNegationConv}}">
                                                <StackPanel Orientation="Horizontal" Spacing="8">
                                                    <ProgressRing IsActive="{Binding IsGeneratingHypnotic}" Width="16" Height="16" Visibility="{Binding IsGeneratingHypnotic, Converter={StaticResource BoolVisConv}}"/>
                                                    <TextBlock Text="Generate Deskripsi"/>
                                                </StackPanel>
                                            </Button>
                                        </Grid>

                                        <TextBox Grid.Row="1" Text="{Binding AiHypnoticDesc, Mode=OneWay}" IsReadOnly="False" AcceptsReturn="True" TextWrapping="Wrap" MinHeight="80" Background="#05000000"/>
                                    </Grid>

                                    <Grid Background="{StaticResource CardBackground}" BorderBrush="{StaticResource CardBorder}" BorderThickness="1" CornerRadius="8" Padding="16">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <Grid Margin="0,0,0,12">
                                            <StackPanel>
                                                <TextBlock Text="ðŸ“¸ AI Art Director (Image Prompt)" FontWeight="Bold" Foreground="Cyan"/>
                                                <TextBlock Text="Dapatkan 'Prompt Ajaib' untuk membuat foto makanan realistis di Midjourney/Bing Image Creator." FontSize="10" Opacity="0.6"/>
                                            </StackPanel>
                                            <Button HorizontalAlignment="Right" Command="{Binding GenerateImagePromptCommand}" IsEnabled="{Binding IsGeneratingImagePrompt, Converter={StaticResource BoolNegationConv}}">
                                                <StackPanel Orientation="Horizontal" Spacing="8">
                                                    <ProgressRing IsActive="{Binding IsGeneratingImagePrompt}" Width="16" Height="16" Visibility="{Binding IsGeneratingImagePrompt, Converter={StaticResource BoolVisConv}}"/>
                                                    <TextBlock Text="Buat Prompt Gambar"/>
                                                </StackPanel>
                                            </Button>
                                        </Grid>

                                        <TextBox Grid.Row="1" Text="{Binding AiImagePrompt, Mode=OneWay}" IsReadOnly="False" AcceptsReturn="True" TextWrapping="Wrap" MinHeight="60" Background="#05000000" ToolTipService.ToolTip="Copy teks ini lalu paste di Bing Image Creator"/>
                                    </Grid>

                                </StackPanel>
                            </ScrollViewer>
                        </TabViewItem>

                    </TabView>
                </StackPanel>
            </ScrollViewer>

            <Grid Grid.Row="2" Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}" Padding="20,16" BorderThickness="0,1,0,0" BorderBrush="{StaticResource CardBorder}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="1.5*"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" VerticalAlignment="Center">
                    <TextBlock Text="TOTAL PRODUCTION COST" FontSize="10" FontWeight="Bold" Opacity="0.5" CharacterSpacing="50"/>
                    <TextBlock Text="{Binding SelectedRecipe.TotalBatchCost, Converter={StaticResource MoneyConv}}" FontSize="20" FontWeight="Bold" Foreground="Red"/>
                    <TextBlock Text="Untuk 1 Batch Produksi" FontSize="10" Opacity="0.5"/>
                </StackPanel>

                <Rectangle Grid.Column="1" Width="1" Fill="Gray" Opacity="0.2" Margin="16,4"/>

                <StackPanel Grid.Column="2" VerticalAlignment="Center">
                    <TextBlock Text="COST PER UNIT (HPP)" FontSize="10" FontWeight="Bold" Opacity="0.5" CharacterSpacing="50"/>
                    <TextBlock Text="{Binding SelectedRecipe.CostPerUnit, Converter={StaticResource MoneyConv}}" FontSize="20" FontWeight="Bold" Foreground="OrangeRed"/>
                    <TextBlock Text="Modal per Porsi Bersih" FontSize="10" Opacity="0.5"/>
                </StackPanel>

                <Rectangle Grid.Column="3" Width="1" Fill="Gray" Opacity="0.2" Margin="16,4"/>

                <Grid Grid.Column="4" VerticalAlignment="Center" HorizontalAlignment="Right">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel HorizontalAlignment="Right" Margin="0,0,16,0">
                        <TextBlock Text="FOOD COST %" FontSize="10" FontWeight="Bold" Opacity="0.5" HorizontalAlignment="Right" CharacterSpacing="50"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <TextBlock Text="{Binding SelectedRecipe.FoodCostPercentage}" FontSize="28" FontWeight="Bold" Foreground="{ThemeResource SystemControlForegroundBaseHighBrush}"/>
                            <TextBlock Text="%" FontSize="16" VerticalAlignment="Bottom" Margin="2,0,0,6" Opacity="0.6"/>
                        </StackPanel>
                    </StackPanel>

                    <StackPanel Grid.Column="1" VerticalAlignment="Center" Background="#10000000" Padding="8,4" CornerRadius="4">
                        <TextBlock Text="Target: &lt;35%" FontSize="10" Opacity="0.5"/>
                        <TextBlock Text="{Binding SelectedRecipe.GrossProfitPerUnit, Converter={StaticResource MoneyConv}}" FontSize="12" FontWeight="Bold" Foreground="Green" ToolTipService.ToolTip="Profit per Porsi"/>
                    </StackPanel>
                </Grid>
            </Grid>
        </Grid>
    </Grid>
</Page>