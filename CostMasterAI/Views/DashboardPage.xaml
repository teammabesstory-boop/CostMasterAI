<Page
    x:Class="CostMasterAI.Views.DashboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    mc:Ignorable="d">

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid Margin="0,0,0,24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <StackPanel>
                <TextBlock Text="Executive Dashboard ðŸ“Š" Style="{StaticResource TitleTextBlockStyle}"/>
                <TextBlock Text="Enterprise Analytics &amp; Financial Health" Opacity="0.6"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                <ProgressRing IsActive="{Binding IsLoading}" Width="20" Height="20"/>
                <TextBlock Text="{Binding StatusMessage}" Opacity="0.5" FontStyle="Italic"/>
            </StackPanel>
        </Grid>

        <TabView Grid.Row="1" IsAddTabButtonVisible="False">
            
            <TabViewItem Header="Overview &amp; KPIs">
                <TabViewItem.IconSource>
                    <SymbolIconSource Symbol="OutlineStar"/>
                </TabViewItem.IconSource>

                <TabViewItem.Content>
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <Grid Padding="0,20,0,20" RowSpacing="24">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Grid Grid.Row="0" ColumnSpacing="16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <Grid Grid.Column="0" Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}" Padding="20" CornerRadius="12" BorderThickness="1" BorderBrush="#2200FF00">
                                    <StackPanel>
                                        <TextBlock Text="Gross Profit Margin (Avg)" Opacity="0.6" FontSize="12" FontWeight="Bold"/>
                                        <TextBlock Text="{Binding GlobalGrossProfitMargin}" FontSize="42" FontWeight="Bold" Foreground="Green" Margin="0,8,0,0"/>
                                        <TextBlock Text="Target: >50%" FontSize="10" Opacity="0.4" Margin="0,4,0,0"/>
                                    </StackPanel>
                                </Grid>

                                <Grid Grid.Column="1" Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}" Padding="20" CornerRadius="12">
                                    <StackPanel>
                                        <TextBlock Text="Total HPP Produksi" Opacity="0.6" FontSize="12" FontWeight="Bold"/>
                                        <TextBlock Text="{Binding TotalProductionCost, Converter={StaticResource MoneyConv}}" FontSize="32" FontWeight="Bold" Margin="0,16,0,0"/>
                                        <TextBlock Text="All Batches Combined" FontSize="10" Opacity="0.4" Margin="0,4,0,0"/>
                                    </StackPanel>
                                </Grid>

                                <Grid Grid.Column="2" Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}" Padding="20" CornerRadius="12">
                                    <StackPanel>
                                        <TextBlock Text="Efficiency Score" Opacity="0.6" FontSize="12" FontWeight="Bold"/>
                                        <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Bottom" Margin="0,8,0,0">
                                            <TextBlock Text="{Binding EfficiencyScore}" FontSize="42" FontWeight="Bold" Foreground="#2196F3"/>
                                            <TextBlock Text="/100" FontSize="18" VerticalAlignment="Bottom" Opacity="0.5" Margin="0,0,0,8"/>
                                        </StackPanel>
                                        <TextBlock Text="{Binding EfficiencyStatus}" FontWeight="SemiBold" Foreground="Orange"/>
                                    </StackPanel>
                                </Grid>
                            </Grid>

                            <Grid Grid.Row="1" Background="{ThemeResource SystemControlBackgroundBaseLowBrush}" Padding="20" CornerRadius="12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Spacing="12" Margin="0,0,24,0">
                                    <TextBlock Text="ðŸ’¸ Cost Structure Breakdown" Style="{StaticResource SubtitleTextBlockStyle}"/>
                                    <ItemsControl ItemsSource="{Binding CostStructure}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Grid Margin="0,0,0,12">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="100"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="80"/>
                                                    </Grid.ColumnDefinitions>
                                                    
                                                    <TextBlock Text="{Binding Category}" VerticalAlignment="Center" FontWeight="SemiBold"/>
                                                    
                                                    <Grid Grid.Column="1" Height="20" Margin="12,0" Background="#22808080" CornerRadius="4">
                                                        <Grid HorizontalAlignment="Left" Background="{Binding Color}" Width="{Binding Percentage, Converter={StaticResource PercentageToWidthConv}}" CornerRadius="4"/>
                                                    </Grid>
                                                    
                                                    <TextBlock Grid.Column="2" Text="{Binding Amount, Converter={StaticResource MoneyConv}}" HorizontalAlignment="Right" FontSize="12"/>
                                                </Grid>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Spacing="12" BorderThickness="1,0,0,0" BorderBrush="Gray" Padding="24,0,0,0">
                                    <TextBlock Text="ðŸš¨ Top 5 Cost Drivers (Pemborosan)" Style="{StaticResource SubtitleTextBlockStyle}" Foreground="OrangeRed"/>
                                    <ListView ItemsSource="{Binding TopCostDrivers}" SelectionMode="None">
                                        <ListView.ItemTemplate>
                                            <DataTemplate>
                                                <Grid Padding="0,8">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <StackPanel>
                                                        <TextBlock Text="{Binding Name}" FontWeight="Bold"/>
                                                        <TextBlock Text="{Binding Percentage}" FontSize="10" Opacity="0.6"/>
                                                    </StackPanel>
                                                    <TextBlock Grid.Column="1" Text="{Binding TotalCostContribution, Converter={StaticResource MoneyConv}}" Foreground="Red"/>
                                                </Grid>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                    </ListView>
                                </StackPanel>
                            </Grid>

                        </Grid>
                    </ScrollViewer>
                </TabViewItem.Content>
            </TabViewItem>

            <TabViewItem Header="Product Matrix (BCG)">
                <TabViewItem.IconSource>
                    <SymbolIconSource Symbol="Switch"/>
                </TabViewItem.IconSource>

                <TabViewItem.Content>
                    <Grid Padding="0,20,0,0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="Analisa Kuadran Produk" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,0,0,24"/>

                        <Grid Grid.Row="1" ColumnSpacing="16" RowSpacing="16">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <Grid Grid.Row="0" Grid.Column="0" Background="#1100FF00" BorderBrush="Green" BorderThickness="1" CornerRadius="8" Padding="16">
                                <StackPanel>
                                    <TextBlock Text="â­ STARS" FontWeight="Bold" Foreground="Green" FontSize="18"/>
                                    <TextBlock Text="Profit Tinggi, Volume Tinggi" FontSize="10" Opacity="0.6"/>
                                    <TextBlock Text="{Binding StarProductsCount}" FontSize="48" HorizontalAlignment="Right" Foreground="Green"/>
                                    <TextBlock Text="Produk Juara. Pertahankan kualitas!" FontStyle="Italic" Opacity="0.7"/>
                                </StackPanel>
                            </Grid>

                            <Grid Grid.Row="0" Grid.Column="1" Background="#11FFFF00" BorderBrush="#FFC107" BorderThickness="1" CornerRadius="8" Padding="16">
                                <StackPanel>
                                    <TextBlock Text="ðŸ§© PUZZLES" FontWeight="Bold" Foreground="#FFC107" FontSize="18"/>
                                    <TextBlock Text="Profit Tinggi, Volume Rendah" FontSize="10" Opacity="0.6"/>
                                    <TextBlock Text="{Binding PuzzleCount}" FontSize="48" HorizontalAlignment="Right" Foreground="#FFC107"/>
                                    <TextBlock Text="Perlu Marketing lebih gencar." FontStyle="Italic" Opacity="0.7"/>
                                </StackPanel>
                            </Grid>

                            <Grid Grid.Row="1" Grid.Column="0" Background="#110000FF" BorderBrush="Blue" BorderThickness="1" CornerRadius="8" Padding="16">
                                <StackPanel>
                                    <TextBlock Text="ðŸ® CASH COWS" FontWeight="Bold" Foreground="Blue" FontSize="18"/>
                                    <TextBlock Text="Profit Rendah, Volume Tinggi" FontSize="10" Opacity="0.6"/>
                                    <TextBlock Text="{Binding CashCowCount}" FontSize="48" HorizontalAlignment="Right" Foreground="Blue"/>
                                    <TextBlock Text="Mesin uang. Efisiensikan HPP!" FontStyle="Italic" Opacity="0.7"/>
                                </StackPanel>
                            </Grid>

                            <Grid Grid.Row="1" Grid.Column="1" Background="#11FF0000" BorderBrush="Red" BorderThickness="1" CornerRadius="8" Padding="16">
                                <StackPanel>
                                    <TextBlock Text="ðŸ¶ DOGS" FontWeight="Bold" Foreground="Red" FontSize="18"/>
                                    <TextBlock Text="Profit Rendah, Volume Rendah" FontSize="10" Opacity="0.6"/>
                                    <TextBlock Text="{Binding DogCount}" FontSize="48" HorizontalAlignment="Right" Foreground="Red"/>
                                    <TextBlock Text="Evaluasi atau Hapus menu ini." FontStyle="Italic" Opacity="0.7"/>
                                </StackPanel>
                            </Grid>
                        </Grid>
                    </Grid>
                </TabViewItem.Content>
            </TabViewItem>

        </TabView>
    </Grid>
</Page>